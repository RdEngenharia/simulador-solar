<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador Solar | RD Engenharia Elétrica</title>
  <!-- Font Awesome para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: Arial, sans-serif; background: #f2f6fa; padding: 20px; }
    .box { max-width: 460px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .logo { text-align: center; }
    .logo img { max-width: 150px; display:block; margin:auto; }
    input, select, button { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; }
    button { border: none; border-radius: 5px; cursor: pointer; }
    button.simular { background: #0a7cff; color:#fff; }
    button.whatsapp { background: #25d366; color:#fff; }
    .resultado { margin-top: 15px; font-size: 14px; }
    .aviso { font-size: 12px; color: #555; margin-top:8px; }
    .item { display:flex; align-items:center; margin-bottom:8px; }
    .item i { color:#0a7cff; margin-right:8px; width:20px; text-align:center; }
    .financiamento { margin-top:10px; font-size:14px; color:#d35400; }
    .economia { color:#27ae60; font-weight:bold; }
    .retorno { color:#e67e22; font-weight:bold; }
    .carencia { font-style:italic; font-size:12px; color:#c0392b; margin-left:5px; }
  </style>
</head>
<body>
  <div class="box">
    <div class="logo">
      <img src="logo.png">
    </div>
    <h3>Simulador de Energia Solar</h3>
    <input type="text" id="nome" placeholder="Nome do cliente">
    <select id="padrao">
      <option value="">Tipo de padrão</option>
      <option value="mono">Monofásico</option>
      <option value="bi">Bifásico</option>
      <option value="tri">Trifásico</option>
    </select>
    <input type="number" id="conta" placeholder="Valor da conta de luz (R$)">
    <button class="simular" onclick="simular()"><i class="fas fa-solar-panel"></i> Simular</button>
    <div class="resultado" id="resultado"></div>
    <a id="btnWhats" href="#" target="_blank">
      <button class="whatsapp"><i class="fab fa-whatsapp"></i> Falar no WhatsApp</button>
    </a>
  </div>

<script>
let dadosPDF = {};

function formatBR(valor) {
  let n = Number(valor).toFixed(2);
  let partes = n.split('.');
  partes[0] = partes[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  return partes.join(',');
}

function simular() {
  const nome = document.getElementById("nome").value.trim();
  const padrao = document.getElementById("padrao").value;
  const conta = Number(document.getElementById("conta").value);

  if(!nome || !padrao || conta <= 0){
    alert("Preencha todos os campos corretamente.");
    return;
  }

  const whatsapp = "73991317853";
  const valorKwh = 1.20; 
  const taxaInjecao = 0.19;
  const consumoSimultaneo = 0.5;
  const geracaoPainel = 70;

  const consumoMedio = conta / valorKwh;
  const taxaMinima = padrao === "mono" ? 32 : padrao === "bi" ? 50 : 90;

  // Kits disponíveis
  const kits = [
    {paineis: 4, valor: 7500},
    {paineis: 6, valor: 10000},
    {paineis: 8, valor: 12000},
    {paineis: 10, valor: 14000},
    {paineis: 12, valor: 16000},
    {paineis: 14, valor: 19000}
  ];

  let paineisEscolhidos = kits.find(k => k.paineis >= Math.ceil(consumoMedio / geracaoPainel));

  if(!paineisEscolhidos){
    document.getElementById("resultado").innerHTML = `<b>Consumo muito alto para simulação.</b><br>Entre em contato pelo WhatsApp para orçamento.`;
    document.getElementById("btnWhats").href = `https://wa.me/${whatsapp}?text=Olá! Preciso de orçamento para consumo acima de 14 painéis.`;
    return;
  }

  const paineis = paineisEscolhidos.paineis;
  const valorKit = paineisEscolhidos.valor;

  const geracaoMensal = paineis * geracaoPainel;
  const consumoInstantaneo = geracaoMensal * consumoSimultaneo;
  const energiaCompensada = geracaoMensal - consumoInstantaneo;
  const taxaPorInjecao = energiaCompensada * taxaInjecao;
  const contaPosSolar = Math.max(taxaPorInjecao, taxaMinima);
  const economiaMensal = conta - contaPosSolar;
  const retorno = (valorKit / (economiaMensal * 12)).toFixed(1);

  let economia25 = 0;
  for(let i=0;i<25;i++){
    economia25 += economiaMensal*12*Math.pow(1.02,i);
  }
  economia25 = economia25.toFixed(2);

  // Parcelas
  let parcelas = [];
  switch(valorKit){
    case 7500: parcelas=[{q:12,v:837.48},{q:36,v:384.20},{q:48,v:333.43},{q:60,v:305.87}]; break;
    case 10000: parcelas=[{q:12,v:1116.64},{q:36,v:512.33},{q:48,v:445.40},{q:60,v:408.25}]; break;
    case 12000: parcelas=[{q:12,v:1339.97},{q:36,v:616.40},{q:48,v:534.48},{q:60,v:489.39}]; break;
    case 14000: parcelas=[{q:12,v:1563.97},{q:36,v:716.13},{q:48,v:622.12},{q:60,v:569.70}]; break;
    case 16000: parcelas=[{q:12,v:1782.60},{q:36,v:815.00},{q:48,v:710.00},{q:60,v:650.00}]; break;
    case 19000: parcelas=[{q:12,v:2124.90},{q:36,v:974.60},{q:48,v:847.20},{q:60,v:775.50}]; break;
  }

  dadosPDF = {nome,padrao,conta,paineis,valorKit,contaPosSolar,retorno,economia25,parcelas,geracaoMensal,consumoMedio};

  let financHTML = "<div class='financiamento'><b>Simulação de financiamento:</b> <span class='carencia'>(carência de até 90 dias)</span><br>";
  parcelas.forEach(p => { financHTML += `<i class="fas fa-credit-card"></i> ${p.q}x de R$ ${formatBR(p.v)}<br>`; });
  financHTML += "</div>";

  document.getElementById("resultado").innerHTML = `
    <div class="item"><i class="fas fa-user"></i> <b>Cliente:</b> ${nome}</div>
    <div class="item"><i class="fas fa-bolt"></i> <b>Padrão:</b> ${padrao==='mono'?'Monofásico':padrao==='bi'?'Bifásico':'Trifásico'}</div>
    <div class="item"><i class="fas fa-bolt"></i> <b>Consumo médio mensal:</b> ${formatBR(consumoMedio)} kWh</div>
    <div class="item"><i class="fas fa-solar-panel"></i> <b>Kit indicado:</b> ${paineis} painéis de 570W (Geração estimada/mês: ${formatBR(geracaoMensal)} kWh)</div>
    <div class="item"><i class="fas fa-money-bill-wave"></i> <b>Valor à vista:</b> R$ ${formatBR(valorKit)}</div>
    ${financHTML}
    <div class="item economia"><i class="fas fa-coins"></i> <b>Conta após solar:</b> R$ ${formatBR(contaPosSolar)}</div>
    <div class="item economia"><i class="fas fa-hand-holding-usd"></i> <b>Economia mensal:</b> R$ ${formatBR(economiaMensal)}</div>
    <div class="item retorno"><i class="fas fa-chart-line"></i> <b>Retorno do investimento:</b> ${retorno} anos</div>
    <div class="item retorno"><i class="fas fa-calendar-alt"></i> <b>Economia estimada em 25 anos:</b> R$ ${formatBR(economia25)}</div>
    <div class="aviso">* Simulação parcial. Valores podem variar conforme consumo e análise do banco.</div>
  `;

  document.getElementById("btnWhats").href = `https://wa.me/${whatsapp}?text=Olá! Fiz uma simulação solar.%0ANome:${nome}%0APadrão:${padrao}%0AKit:${paineis} painéis`;
}
</script>
</body>
</html>
